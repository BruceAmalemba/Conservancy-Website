<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Tags for SEO and Accessibility -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ambururu Knowledge Hub: A premier e-library featuring law, mathematics, data science, and Luo culture, with brain teasers, fun facts, and tributes to Hon. Justice Anthony Ombwayo and Bruce Amalemba. Discover eco-luxury in Musanda, Siaya, Kenya.">
    <meta name="keywords" content="Ambururu, Knowledge Hub, e-library, law, mathematics, data science, Luo culture, Justice Anthony Ombwayo, Bruce Amalemba, eco-luxury, Musanda, Siaya, Kenya">
    <meta name="author" content="Bruce Amalemba">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#0A1A2F">
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Ambururu Knowledge Hub">
    <meta property="og:description" content="Explore a world-class e-library, interactive brain teasers, fun facts, and tributes to Hon. Justice Anthony Ombwayo and Bruce Amalemba at Ambururu Waterfalls & Resort.">
    <meta property="og:image" content="/images/og-image.jpg">
    <meta property="og:url" content="/knowledge.html">
    <meta property="og:type" content="website">
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Ambururu Knowledge Hub",
        "url": "/knowledge.html",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "/knowledge.html?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico">
    <!-- Title -->
    <title>Ambururu Knowledge Hub | Ambururu Waterfalls & Resort</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@300;600&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <!-- Fuse.js for Search -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js" integrity="sha512-5k3b+6qBPvKzqE0y0vV0o1QDrabT5b8s2k7q7jV5q0b0A6z+2h0qJGL3uUExgWiw6vW7r+6+Wy0kD5rD1rNYc1A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Three.js for 3D Visualizations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js" integrity="sha512-5z/5r2n9b0u2oH3I6o1y6j8o1y3H3I6o1y6j8o1y3H3I6o1y6j8o1y3H3I6o1y6j8o1y3H3I6o1y6j8o1y3H==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Inline CSS -->
    <style>
        :root {
            --primary-dark: #0A1A2F;
            --secondary-dark: #1C2526;
            --accent-gold: #FFD700;
            --accent-silver: #C0C0C0;
            --text-light: #F5F6F5;
            --text-dark: #1C2526;
            --gradient-nebula: linear-gradient(135deg, rgba(10, 26, 47, 0.8), rgba(46, 139, 87, 0.3));
            --glass-bg: rgba(255, 255, 255, 0.1);
            --font-size-base: 1rem;
            --transition: all 0.3s ease;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--primary-dark);
            color: var(--text-light);
            line-height: 1.6;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        body.loaded {
            opacity: 1;
        }
        body.high-contrast {
            background: #000;
            color: #FFF;
            --accent-gold: #FFFF00;
            --accent-silver: #FFFFFF;
        }
        .starry-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: var(--gradient-nebula);
        }
        header {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        header h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2rem;
            color: var(--accent-gold);
            text-transform: uppercase;
        }
        nav a {
            color: var(--text-light);
            text-decoration: none;
            margin: 0 1rem;
            font-size: 1.1rem;
            transition: var(--transition);
        }
        nav a:hover, nav a:focus {
            color: var(--accent-gold);
            transform: translateY(-2px);
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }
        .panel {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 2rem;
            min-height: 100vh;
        }
        .left-panel, .right-panel {
            background: var(--glass-bg);
            padding: 2rem;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        .main-panel {
            padding: 2rem;
        }
        .section {
            margin-bottom: 2rem;
            background: var(--glass-bg);
            padding: 2rem;
            border-radius: 12px;
            transition: transform 0.3s ease;
        }
        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(255, 215, 0, 0.3);
        }
        h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2rem;
            color: var(--accent-gold);
            margin-bottom: 1rem;
        }
        h3 {
            font-size: 1.5rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }
        .book-card, .teaser-card, .fact-card, .portfolio-card {
            display: flex;
            align-items: center;
            background: var(--glass-bg);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            transition: var(--transition);
        }
        .book-card:hover, .teaser-card:hover, .fact-card:hover, .portfolio-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
        }
        .book-card img, .fact-card img, .portfolio-card img {
            width: 100px;
            height: auto;
            border-radius: 8px;
            margin-right: 1.5rem;
            object-fit: cover;
        }
        .ambur-button {
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-silver));
            color: var(--text-dark);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: bold;
            transition: var(--transition);
        }
        .ambur-button:hover {
            background: linear-gradient(135deg, var(--accent-silver), var(--accent-gold));
            transform: scale(1.1);
        }
        .reader-container {
            background: var(--text-light);
            color: var(--text-dark);
            padding: 1.5rem;
            border-radius: 8px;
            max-height: 500px;
            overflow-y: auto;
        }
        .reader-container.sepia {
            background: #F4ECD8;
        }
        .reader-container.dark {
            background: var(--secondary-dark);
            color: var(--text-light);
        }
        .autocomplete-suggestions {
            position: absolute;
            background: var(--glass-bg);
            color: var(--text-light);
            border-radius: 8px;
            max-height: 250px;
            overflow-y: auto;
            width: 100%;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .autocomplete-item {
            padding: 0.75rem;
            cursor: pointer;
        }
        .autocomplete-item:hover {
            background: var(--accent-gold);
            color: var(--text-dark);
        }
        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 8px;
            border-radius: 4px;
            margin: 1rem 0;
        }
        .progress-bar div {
            background: var(--accent-gold);
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .chat-box {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 1rem;
            background: var(--glass-bg);
            padding: 1.5rem;
            border-radius: 10px;
        }
        .chat-message {
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
        }
        .chat-message.user {
            background: var(--accent-gold);
            color: var(--text-dark);
            text-align: right;
        }
        .chat-message.bot {
            background: var(--secondary-dark);
            color: var(--text-light);
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--glass-bg);
            color: var(--text-light);
            padding: 2rem;
            border-radius: 12px;
            max-width: 600px;
            z-index: 1500;
            backdrop-filter: blur(10px);
        }
        .timeline {
            position: relative;
            padding: 2rem 0;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 6px;
            background: var(--accent-gold);
            transform: translateX(-50%);
        }
        .timeline-item {
            position: relative;
            margin: 2rem 0;
            width: 45%;
            padding: 1.5rem;
            background: var(--glass-bg);
            border-radius: 10px;
            transition: var(--transition);
        }
        .timeline-item:hover {
            transform: scale(1.05);
        }
        .timeline-item.left {
            left: 0;
            text-align: right;
        }
        .timeline-item.right {
            left: 55%;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            top: 20px;
            width: 20px;
            height: 20px;
            background: var(--accent-gold);
            border-radius: 50%;
        }
        .timeline-item.left::before {
            right: -10px;
        }
        .timeline-item.right::before {
            left: -10px;
        }
        .accordion-header {
            background: var(--glass-bg);
            padding: 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
        }
        .accordion-header:hover {
            background: var(--accent-gold);
            color: var(--text-dark);
        }
        .accordion-content {
            display: none;
            padding: 1.5rem;
            background: var(--glass-bg);
            border-radius: 8px;
        }
        .accordion-content.active {
            display: block;
        }
        .gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .gallery img {
            width: 150px;
            height: auto;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .gallery img:hover {
            transform: scale(1.1);
        }
        #planet-canvas {
            width: 100%;
            height: 250px;
            border-radius: 10px;
        }
        #tree-canvas {
            width: 100%;
            height: 250px;
            border-radius: 10px;
        }
        .debug-console {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.8);
            color: var(--text-light);
            padding: 1.5rem;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
        }
        .loading-spinner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            color: var(--accent-gold);
            z-index: 2000;
        }
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--secondary-dark);
            color: var(--text-light);
            padding: 1rem;
            border-radius: 8px;
            z-index: 1500;
        }
        .notification.success { background: #2E8B57; }
        .notification.error { background: #FF4D4D; }
        .notification.warning { background: #FFA500; }
        .notification.info { background: #1E90FF; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }
        .highlight {
            border: 3px solid var(--accent-gold);
            animation: pulse 1.5s infinite;
        }
        @media (max-width: 1024px) {
            .panel {
                grid-template-columns: 1fr;
            }
            .timeline::before {
                left: 20px;
            }
            .timeline-item {
                width: 90%;
                left: 40px !important;
                text-align: left !important;
            }
            .timeline-item::before {
                left: -30px !important;
            }
        }
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
            }
            nav {
                margin-top: 1rem;
            }
            nav a {
                margin: 0 0.5rem;
                font-size: 1rem;
            }
            .container {
                padding: 1rem;
            }
            .book-card img, .fact-card img, .portfolio-card img {
                width: 80px;
            }
        }
    </style>
</head>
<body>
    <!-- File Header -->
    <!--
        File: knowledge.html
        Purpose: Ambururu Knowledge Hub e-library and tribute page honoring Hon. Justice Anthony Ombwayo.
        Features: Cosmic UI, e-library with fuzzy search, brain teasers, fun facts, 3D visualizations, tributes.
        Author: Bruce Amalemba
        Date: June 25, 2025
    -->

    <!-- Fallback for No JavaScript -->
    <noscript>
        <div class="container">
            <h1>Ambururu Knowledge Hub</h1>
            <p>Please enable JavaScript to access the full experience.</p>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="sustainability.html">Sustainability</a></li>
                <li><a href="events.html">Events</a></li>
                <li><a href="gamershub.html">Gamers Hub</a></li>
            </ul>
        </div>
    </noscript>

    <!-- Cosmic Background -->
    <div class="starry-background" id="starryBackground"></div>

    <!-- Header -->
    <header role="banner">
        <h1>Ambururu Knowledge Hub</h1>
        <nav aria-label="Main navigation">
            <a href="index.html">Home</a>
            <a href="sustainability.html">Sustainability</a>
            <a href="events.html">Events</a>
            <a href="gamershub.html">Gamers Hub</a>
        </nav>
    </header>

    <!-- Main Container -->
    <div class="container">
        <div class="panel">
            <!-- Left Panel -->
            <aside class="left-panel" aria-label="User profile and settings">
                <div class="section" id="profile">
                    <h2>Profile</h2>
                    <img id="avatar" src="/images/avatar.jpg" alt="User avatar" loading="lazy">
                    <p><strong>Nickname:</strong> <span id="nicknameDisplay">Guardian</span></p>
                    <p><strong>Shards:</strong> <span id="shardsDisplay">0</span></p>
                    <p><strong>Rank:</strong> <span id="rankLevelDisplay">1</span> (<span id="rankXPDisplay">0</span> XP)</p>
                    <p><strong>Trees Planted:</strong> <span id="treesPlantedDisplay">0</span></p>
                    <button id="editNicknameBtn" class="ambur-button" aria-label="Edit nickname">Edit Nickname</button>
                    <button id="resetProfileBtn" class="ambur-button" aria-label="Reset profile">Reset Profile</button>
                    <button id="resumeReadingBtn" class="ambur-button" style="display: none;" aria-label="Resume reading">Resume Reading</button>
                </div>
                <div class="section" id="settings">
                    <h2>Settings</h2>
                    <label>Theme:
                        <select id="themeSelect" aria-label="Select theme">
                            <option value="dark">Dark</option>
                            <option value="light">Light</option>
                        </select>
                    </label>
                    <label>Font Size:
                        <input type="range" id="fontSize" min="0.8" max="1.4" step="0.1" value="1" aria-label="Adjust font size">
                    </label>
                    <label>Reader Theme:
                        <select id="readerTheme" aria-label="Select reader theme">
                            <option value="default">Default</option>
                            <option value="sepia">Sepia</option>
                            <option value="dark">Dark</option>
                        </select>
                    </label>
                    <label>Language:
                        <select id="languageSelect" aria-label="Select language">
                            <option value="en">English</option>
                            <option value="sw">Swahili</option>
                            <option value="dho">Dholuo</option>
                        </select>
                    </label>
                    <label><input type="checkbox" id="highContrastToggle" aria-label="Toggle high contrast mode"> High Contrast</label>
                    <label><input type="checkbox" id="debugToggle" aria-label="Toggle debug mode"> Debug Mode</label>
                </div>
            </aside>

            <!-- Main Panel -->
            <main class="main-panel" aria-label="Main content">
                <div class="section" id="welcomeMessage">
                    <h2>Welcome</h2>
                    <p>Explore our state-of-the-art e-library, engage with brain teasers, discover fun facts, and pay tribute to Hon. Justice Anthony Ombwayo and Bruce Amalemba.</p>
                </div>
                <div class="section" id="searchSection">
                    <h2>Search Library</h2>
                    <input type="text" id="searchInput" placeholder="Search books by title, author, or keyword..." aria-label="Search library content">
                    <div id="autocompleteSuggestions" class="autocomplete-suggestions"></div>
                    <div>
                        <label>Category:
                            <select id="genreFilter" aria-label="Filter by genre">
                                <option value="all">All</option>
                                <option value="law">Law</option>
                                <option value="mathematics">Mathematics</option>
                                <option value="data-science">Data Science</option>
                                <option value="luo-culture">Luo Culture</option>
                            </select>
                        </label>
                        <label><input type="checkbox" id="tagFilterNew"> New</label>
                        <label><input type="checkbox" id="tagFilterPopular"> Popular</label>
                        <label>Sort:
                            <select id="sortFilter" aria-label="Sort books">
                                <option value="title">Title</option>
                                <option value="author">Author</option>
                                <option value="date">Publication Date</option>
                            </select>
                        </label>
                    </div>
                </div>
                <div class="section" id="ambururuLibrary">
                    <h2>E-Library</h2>
                    <div id="libraryBooks"></div>
                </div>
                <div class="section" id="readerSection">
                    <h2>Reader</h2>
                    <div id="readerContainer" class="reader-container">
                        <div id="readerContent"></div>
                        <div class="progress-bar"><div style="width: 0%;"></div></div>
                        <button id="prevPageBtn" class="ambur-button" aria-label="Previous page">Previous</button>
                        <button id="nextPageBtn" class="ambur-button" aria-label="Next page">Next</button>
                        <button id="bookmarkBtn" class="ambur-button" aria-label="Add bookmark">Bookmark</button>
                        <button id="annotateBtn" class="ambur-button" aria-label="Add annotation">Annotate</button>
                    </div>
                </div>
                <div class="section" id="brainTeasers">
                    <h2>Brain Teasers</h2>
                    <div id="teaserList"></div>
                    <div id="quizQuestion"></div>
                    <button id="quizSubmitBtn" class="ambur-button" style="display: none;" aria-label="Submit quiz answer">Submit</button>
                    <p id="quizResult"></p>
                </div>
                <div class="section" id="funFacts">
                    <h2>Fun Facts</h2>
                    <div id="factList"></div>
                </div>
                <div class="section" id="ombwayoTribute">
                    <h2>Hon. Justice Anthony Ombwayo</h2>
                    <p>A distinguished Kenyan judge, Hon. Justice Anthony Ombwayo has profoundly shaped environmental and land law, championing justice and sustainability in Kenya.</p>
                    <img src="/images/ombwayo.jpg" alt="Hon. Justice Anthony Ombwayo" loading="lazy">
                    <div class="accordion">
                        <div class="accordion-header" aria-controls="ombwayo-bio">Biography</div>
                        <div class="accordion-content" id="ombwayo-bio">
                            <p>Born in Siaya County, Justice Ombwayo earned his LL.B from the University of Nairobi and LL.M in Environmental Law from Moi University. His passion for justice and community welfare has driven his illustrious career.</p>
                        </div>
                    </div>
                    <div class="accordion">
                        <div class="accordion-header" aria-controls="ombwayo-career">Judicial Career</div>
                        <div class="accordion-content" id="ombwayo-career">
                            <p>Appointed as a High Court Judge in 2012, Justice Ombwayo has served in Nakuru, Kisumu, Eldoret, Nyeri, and Kericho. He currently presides at the Environment and Land Court in Kisumu, focusing on environmental justice and land rights.</p>
                        </div>
                    </div>
                    <div class="accordion">
                        <div class="accordion-header" aria-controls="ombwayo-cases">Notable Cases</div>
                        <div class="accordion-content" id="ombwayo-cases">
                            <ul>
                                <li><strong>2025 Nakuru Pollution Case</strong>: Ordered fines and cleanup for Lake Nakuru pollution, protecting local ecosystems.</li>
                                <li><strong>2023 Kisumu Land Dispute</strong>: Upheld community land rights in Siaya, preventing illegal land grabbing.</li>
                                <li><strong>2014 Nakuru Land Case</strong>: Recused himself to ensure judicial impartiality, earning public trust.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="accordion">
                        <div class="accordion-header" aria-controls="ombwayo-publications">Publications</div>
                        <div class="accordion-content" id="ombwayo-publications">
                            <ul>
                                <li><em>Land and Environment Law in Kenya</em> (2020, Co-author)</li>
                                <li>"Environmental Justice in Kenya" in <em>Kenya Law Review</em> (2018)</li>
                                <li>"Land Rights and Community Welfare" in <em>African Law Journal</em> (2022)</li>
                            </ul>
                        </div>
                    </div>
                    <div class="accordion">
                        <div class="accordion-header" aria-controls="ombwayo-awards">Awards & Recognition</div>
                        <div class="accordion-content" id="ombwayo-awards">
                            <ul>
                                <li><strong>2024 Chief Justice Award</strong>: Excellence in Environmental Jurisprudence.</li>
                                <li><strong>2022 Law Society of Kenya Award</strong>: Contributions to Land Law Reforms.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="accordion">
                        <div class="accordion-header" aria-controls="ombwayo-community">Community Impact</div>
                        <div class="accordion-content" id="ombwayo-community">
                            <p>Justice Ombwayo supports the Ambururu Waterfalls conservation project and community education initiatives in Siaya, promoting sustainable development and cultural preservation.</p>
                        </div>
                    </div>
                    <h3>Career Timeline</h3>
                    <div class="timeline">
                        <div class="timeline-item left"><p><strong>1985</strong>: Earned LL.B from University of Nairobi.</p></div>
                        <div class="timeline-item right"><p><strong>1990</strong>: Completed LL.M in Environmental Law, Moi University.</p></div>
                        <div class="timeline-item left"><p><strong>2012</strong>: Appointed High Court Judge.</p></div>
                        <div class="timeline-item right"><p><strong>2018</strong>: Published in <em>Kenya Law Review</em>.</p></div>
                        <div class="timeline-item left"><p><strong>2020</strong>: Co-authored <em>Land and Environment Law in Kenya</em>.</p></div>
                        <div class="timeline-item right"><p><strong>2023</strong>: Ruled on Kisumu land dispute.</p></div>
                        <div class="timeline-item left"><p><strong>2024</strong>: Received Chief Justice Award.</p></div>
                        <div class="timeline-item right"><p><strong>2025</strong>: Nakuru pollution case ruling.</p></div>
                    </div>
                    <h3>Photo Gallery</h3>
                    <div class="gallery">
                        <img src="/images/35.jpg" alt="Justice Ombwayo in court" loading="lazy">
                        <img src="/images/35.jpg" alt="Justice Ombwayo at Ambururu" loading="lazy">
                        <img src="/images/ombwayo3.jpg" alt="Justice Ombwayo receiving award" loading="lazy">
                    </div>
                </div>
                <div class="section" id="amalembaTribute">
                    <h2>Bruce Amalemba</h2>
                    <p>Bruce Amalemba, an Applied Statistics with IT student at Maseno University, is the visionary developer behind this Knowledge Hub.</p>
                    <img src="/images/amalemba.jpg" alt="Bruce Amalemba" loading="lazy">
                    <div class="accordion">
                        <div class="accordion-header" aria-controls="amalemba-bio">About Me</div>
                        <div class="accordion-content" id="amalemba-bio">
                            <p>Bruce is a passionate web developer and data enthusiast, pursuing a degree in Applied Statistics with IT at Maseno University. He combines analytical skills with creative coding to build impactful digital solutions.</p>
                        </div>
                    </div>
                    <div class="accordion">
                        <div class="accordion-header" aria-controls="amalemba-skills">Skills</div>
                        <div class="accordion-content" id="amalemba-skills">
                            <ul>
                                <li>HTML5, CSS3, JavaScript (ES6+)</li>
                                <li>React, Node.js, Express</li>
                                <li>Python, R, SQL for data analysis</li>
                                <li>Figma, Adobe XD for UI/UX design</li>
                                <li>Git, GitHub for version control</li>
                            </ul>
                        </div>
                    </div>
                    <div class="accordion">
                        <div class="accordion-header" aria-controls="amalemba-portfolio">Portfolio</div>
                        <div class="accordion-content" id="amalemba-portfolio">
                            <div class="portfolio-card">
                                <img src="/images/project1.jpg" alt="Ambururu Knowledge Hub">
                                <div>
                                    <h3>Ambururu Knowledge Hub</h3>
                                    <p>A cosmic-themed e-library with interactive features.</p>
                                    <a href="/knowledge.html" class="ambur-button">View</a>
                                </div>
                            </div>
                            <div class="portfolio-card">
                                <img src="/images/project2.jpg" alt="Data Dashboard">
                                <div>
                                    <h3>Data Analytics Dashboard</h3>
                                    <p>A Python-based dashboard for visualizing statistical data.</p>
                                    <a href="https://github.com/bruceamalemba" class="ambur-button">View</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="accordion">
                        <div class="accordion-header" aria-controls="amalemba-contact">Contact Me</div>
                        <div class="accordion-content" id="amalemba-contact">
                            <p><strong>GitHub:</strong> <a href="https://github.com/bruceamalemba">bruceamalemba</a></p>
                            <p><strong>LinkedIn:</strong> <a href="https://linkedin.com/in/bruceamalemba">Bruce Amalemba</a></p>
                            <form id="contactForm">
                                <label for="contactName">Name:</label>
                                <input type="text" id="contactName" required aria-label="Your name">
                                <label for="contactEmail">Email:</label>
                                <input type="email" id="contactEmail" required aria-label="Your email">
                                <label for="contactMessage">Message:</label>
                                <textarea id="contactMessage" required aria-label="Your message"></textarea>
                                <button type="submit" class="ambur-button" aria-label="Send message">Send</button>
                            </form>
                            <p id="contactResult"></p>
                        </div>
                    </div>
                    <h3>Developer Journey</h3>
                    <div class="timeline">
                        <div class="timeline-item left"><p><strong>2020</strong>: Began learning HTML, CSS, and JavaScript.</p></div>
                        <div class="timeline-item right"><p><strong>2022</strong>: Enrolled in Applied Statistics with IT at Maseno University.</p></div>
                        <div class="timeline-item left"><p><strong>2024</strong>: Built first React-based project.</p></div>
                        <div class="timeline-item right"><p><strong>2025</strong>: Launched Ambururu Official Website.</p></div>
                    </div>
                </div>
                <div class="section" id="globalConclave">
                    <h2>Global Conclave</h2>
                    <div id="chatBox" class="chat-box"></div>
                    <input type="text" id="chatInput" placeholder="Ask a question or chat..." aria-label="Chat input">
                    <button id="chatSendBtn" class="ambur-button" aria-label="Send chat message">Send</button>
                </div>
            </main>

            <!-- Right Panel -->
            <aside class="right-panel" aria-label="Additional features">
                <div class="section" id="virtualTreePlanting">
                    <h2>Virtual Tree Planting</h2>
                    <canvas id="treeCanvas" width="300" height="250"></canvas>
                    <button id="plantTreeBtn" class="ambur-button" aria-label="Plant a virtual tree">Plant a Tree</button>
                </div>
                <div class="section" id="guardianFeedback">
                    <h2>Feedback</h2>
                    <textarea id="feedbackInput" placeholder="Share your thoughts..." aria-label="Feedback input"></textarea>
                    <button id="feedbackSubmitBtn" class="ambur-button" aria-label="Submit feedback">Submit</button>
                </div>
                <div class="section" id="visualization">
                    <h2>3D Visualization</h2>
                    <canvas id="planetCanvas"></canvas>
                </div>
            </aside>
        </div>
    </div>

    <!-- Modal -->
    <div id="welcomeModal" class="modal">
        <h2>Welcome to Ambururu Waterfalls Conservancy</h2>
        <p>Discover our e-library, tributes, and interactive features. Take a guided tour!</p>
        <button id="startTourBtn" class="ambur-button" aria-label="Start guided tour">Start Tour</button>
        <button id="closeWelcomeBtn" class="ambur-button" aria-label="Close welcome modal">Close</button>
    </div>

    <!-- Debug Console -->
    <div id="debugConsole" class="debug-console"></div>

    <!-- JavaScript -->
    <script>
        // Configuration
        const CONFIG = {
            MAX_CHAT_MESSAGE_LENGTH: 200,
            MAX_FEEDBACK_LENGTH: 500,
            MAX_NICKNAME_LENGTH: 20,
            TRANSLATIONS: {
                en: {
                    welcome: 'Welcome to Ambururu Knowledge Hub',
                    searchPlaceholder: 'Search books by title, author, or keyword...',
                    profile: 'Profile',
                    settings: 'Settings',
                    elysianLibrary: 'E-Library',
                    globalConclave: 'Global Conclave',
                    virtualTree: 'Virtual Tree Planting',
                    guardianFeedback: 'Feedback',
                    visualization: '3D Visualization',
                },
                sw: {
                    welcome: 'Karibu Kituo cha Maarifa cha Ambururu',
                    searchPlaceholder: 'Tafuta vitabu kwa jina, mwandishi, au neno la msingi...',
                    profile: 'Wasifu',
                    settings: 'Mipangilio',
                    elysianLibrary: 'Maktaba ya Kielektroniki',
                    globalConclave: 'Mkutano wa Kimataifa',
                    virtualTree: 'Upandaji Miti wa Mtandaoni',
                    guardianFeedback: 'Maoni',
                    visualization: 'Taswira ya 3D',
                },
                dho: {
                    welcome: 'Ber e Ambururu Knowledge Hub',
                    searchPlaceholder: 'Non vitabu gi nying, japuoni, kata neno machielo...',
                    profile: 'Profil',
                    settings: 'Mipangaliyo',
                    elysianLibrary: 'E-Maktaba',
                    globalConclave: 'Mkutano marach',
                    virtualTree: 'Pando miti marach',
                    guardianFeedback: 'Maoni',
                    visualization: 'Wach marach 3D',
                },
            },
            TOUR_STEPS: [
                { selector: '#profile', content: 'Manage your profile and track your progress.' },
                { selector: '#searchSection', content: 'Search our extensive e-library.' },
                { selector: '#ombwayoTribute', content: 'Learn about Hon. Justice Anthony Ombwayo.' },
                { selector: '#amalembaTribute', content: 'Discover the creator, Bruce Amalemba.' },
                { selector: '#globalConclave', content: 'Join the global conversation.' },
            ],
        };

        // Mock Data
        const books = [
            { id: '1', title: 'Kenyan Constitutional Law', author: 'John Mwangi', genre: 'law', summary: 'A comprehensive guide to Kenya’s 2010 Constitution.', cover: '/images/book1.jpg', year: 2020, isNew: true, isPopular: true, keywords: ['constitution', 'law', 'kenya'] },
            { id: '2', title: 'Advanced Calculus', author: 'Jane Otieno', genre: 'mathematics', summary: 'In-depth exploration of calculus concepts.', cover: '/images/book2.jpg', year: 2019, isNew: false, isPopular: true, keywords: ['calculus', 'math'] },
            { id: '3', title: 'Python for Data Science', author: 'Mary Achieng', genre: 'data-science', summary: 'Master data analysis with Python.', cover: '/images/book3.jpg', year: 2023, isNew: true, isPopular: false, keywords: ['python', 'data science'] },
            { id: '4', title: 'Luo Cultural Heritage', author: 'Paul Omondi', genre: 'luo-culture', summary: 'A deep dive into Luo traditions and history.', cover: '/images/book4.jpg', year: 2021, isNew: false, isPopular: true, keywords: ['luo', 'culture'] },
            { id: '5', title: 'Environmental Law in Kenya', author: 'Anthony Ombwayo', genre: 'law', summary: 'A seminal work on environmental regulations.', cover: '/images/book5.jpg', year: 2020, isNew: false, isPopular: true, keywords: ['environmental law', 'kenya'] },
            { id: '6', title: 'Linear Algebra', author: 'David Kimani', genre: 'mathematics', summary: 'Fundamentals of linear algebra for students.', cover: '/images/book6.jpg', year: 2018, isNew: false, isPopular: false, keywords: ['linear algebra', 'math'] },
            { id: '7', title: 'Machine Learning Basics', author: 'Sarah Wanjiku', genre: 'data-science', summary: 'Introduction to machine learning algorithms.', cover: '/images/book7.jpg', year: 2024, isNew: true, isPopular: true, keywords: ['machine learning', 'data science'] },
            { id: '8', title: 'Luo Folktales', author: 'Grace Adhiambo', genre: 'luo-culture', summary: 'Collection of traditional Luo stories.', cover: '/images/book8.jpg', year: 2022, isNew: true, isPopular: false, keywords: ['luo', 'folktales'] },
            { id: '9', title: 'Land Law in Kenya', author: 'Peter Ochieng', genre: 'law', summary: 'Detailed analysis of Kenyan land laws.', cover: '/images/book9.jpg', year: 2019, isNew: false, isPopular: true, keywords: ['land law', 'kenya'] },
            { id: '10', title: 'Probability and Statistics', author: 'Michael Njoroge', genre: 'mathematics', summary: 'Core concepts in probability and stats.', cover: '/images/book10.jpg', year: 2020, isNew: false, isPopular: false, keywords: ['probability', 'statistics'] },
            { id: '11', title: 'Data Visualization with R', author: 'Esther Muthoni', genre: 'data-science', summary: 'Create stunning visualizations with R.', cover: '/images/book11.jpg', year: 2023, isNew: true, isPopular: false, keywords: ['data visualization', 'R'] },
            { id: '12', title: 'Luo Music Traditions', author: 'Joseph Odhiambo', genre: 'luo-culture', summary: 'Exploring Luo musical heritage.', cover: '/images/book12.jpg', year: 2021, isNew: false, isPopular: true, keywords: ['luo', 'music'] },
            { id: '13', title: 'Constitutional Reforms', author: 'Ann Wambui', genre: 'law', summary: 'History of Kenyan constitutional changes.', cover: '/images/book13.jpg', year: 2022, isNew: true, isPopular: false, keywords: ['constitution', 'law'] },
            { id: '14', title: 'Differential Equations', author: 'Samuel Kariuki', genre: 'mathematics', summary: 'Solving differential equations.', cover: '/images/book14.jpg', year: 2017, isNew: false, isPopular: false, keywords: ['differential equations', 'math'] },
            { id: '15', title: 'Big Data Analytics', author: 'Lucy Njeri', genre: 'data-science', summary: 'Harnessing big data for insights.', cover: '/images/book15.jpg', year: 2024, isNew: true, isPopular: true, keywords: ['big data', 'analytics'] },
            { id: '16', title: 'Luo Art and Craft', author: 'Mary Akinyi', genre: 'luo-culture', summary: 'Traditional Luo artistic expressions.', cover: '/images/book16.jpg', year: 2020, isNew: false, isPopular: false, keywords: ['luo', 'art'] },
            { id: '17', title: 'Judicial Ethics', author: 'Anthony Ombwayo', genre: 'law', summary: 'Principles of judicial conduct.', cover: '/images/book17.jpg', year: 2021, isNew: false, isPopular: true, keywords: ['judicial ethics', 'law'] },
            { id: '18', title: 'Number Theory', author: 'James Kamau', genre: 'mathematics', summary: 'Exploring properties of numbers.', cover: '/images/book18.jpg', year: 2019, isNew: false, isPopular: false, keywords: ['number theory', 'math'] },
            { id: '19', title: 'Deep Learning', author: 'Rose Atieno', genre: 'data-science', summary: 'Advanced neural network techniques.', cover: '/images/book19.jpg', year: 2023, isNew: true, isPopular: true, keywords: ['deep learning', 'AI'] },
            { id: '20', title: 'Luo Oral Traditions', author: 'Daniel Owino', genre: 'luo-culture', summary: 'Preserving Luo oral history.', cover: '/images/book20.jpg', year: 2022, isNew: true, isPopular: false, keywords: ['luo', 'oral history'] },
        ];
        const teasers = [
            { id: 't1', question: 'What is the square root of 144?', options: ['12', '14', '16'], answer: '12', reward: 50 },
            { id: 't2', question: 'Which act governs Kenyan land law?', options: ['Land Act 2012', 'Penal Code', 'Constitution'], answer: 'Land Act 2012', reward: 75 },
            { id: 't3', question: 'Who authored "Environmental Law in Kenya"?', options: ['Anthony Ombwayo', 'John Mwangi', 'Jane Otieno'], answer: 'Anthony Ombwayo', reward: 100 },
            { id: 't4', question: 'What is the capital of Siaya County?', options: ['Siaya', 'Kisumu', 'Nairobi'], answer: 'Siaya', reward: 50 },
            { id: 't5', question: 'What is Python used for in data science?', options: ['Data analysis', 'Web design', 'Game development'], answer: 'Data analysis', reward: 75 },
        ];
        const funFacts = [
            { id: 'f1', title: 'Luo Naming Traditions', content: 'Luo names often reflect the time or circumstances of birth.', image: '/images/fact1.jpg' },
            { id: 'f2', title: 'Ramanujan’s Number', content: '1729 is the smallest number expressible as the sum of two cubes in two ways.', image: '/images/fact2.jpg' },
            { id: 'f3', title: 'Ambururu Waterfalls', content: 'Located in Siaya, it’s a hub for eco-tourism and conservation.', image: '/images/fact3.jpg' },
            { id: 'f4', title: 'Kenyan Judiciary', content: 'The Environment and Land Court was established in 2011.', image: '/images/fact4.jpg' },
            { id: 'f5', title: 'Data Science Growth', content: 'Data science jobs in Kenya grew by 40% from 2020–2025.', image: '/images/fact5.jpg' },
        ];

        // State
        let state = {
            user: {
                nickname: 'Guardian',
                shards: 0,
                rankLevel: 1,
                rankXP: 0,
                treesPlanted: 0,
                lastBook: null,
                readingProgress: {},
                bookmarks: [],
                annotations: [],
            },
            settings: {
                theme: 'dark',
                fontSize: 1,
                readerTheme: 'default',
                language: 'en',
                highContrast: false,
                debug: false,
            },
            tour: {
                isActive: false,
                currentStep: 0,
                lastCompleted: null,
            },
            library: books,
            chatbotMessages: [],
            trees: [],
        };

        // DOM References
        const DOM = {
            starryBackground: document.getElementById('starryBackground'),
            avatar: document.getElementById('avatar'),
            nicknameDisplay: document.getElementById('nicknameDisplay'),
            shardsDisplay: document.getElementById('shardsDisplay'),
            rankLevelDisplay: document.getElementById('rankLevelDisplay'),
            rankXPDisplay: document.getElementById('rankXPDisplay'),
            treesPlantedDisplay: document.getElementById('treesPlantedDisplay'),
            editNicknameBtn: document.getElementById('editNicknameBtn'),
            resetProfileBtn: document.getElementById('resetProfileBtn'),
            resumeReadingBtn: document.getElementById('resumeReadingBtn'),
            themeSelect: document.getElementById('themeSelect'),
            fontSizeInput: document.getElementById('fontSize'),
            readerThemeSelect: document.getElementById('readerTheme'),
            languageSelect: document.getElementById('languageSelect'),
            highContrastToggle: document.getElementById('highContrastToggle'),
            debugToggle: document.getElementById('debugToggle'),
            searchInput: document.getElementById('searchInput'),
            autocompleteSuggestions: document.getElementById('autocompleteSuggestions'),
            genreFilter: document.getElementById('genreFilter'),
            tagFilterNew: document.getElementById('tagFilterNew'),
            tagFilterPopular: document.getElementById('tagFilterPopular'),
            sortFilter: document.getElementById('sortFilter'),
            libraryBooks: document.getElementById('libraryBooks'),
            readerContainer: document.getElementById('readerContainer'),
            readerContent: document.getElementById('readerContent'),
            readingProgressBar: document.querySelector('#readerSection .progress-bar div'),
            prevPageBtn: document.getElementById('prevPageBtn'),
            nextPageBtn: document.getElementById('nextPageBtn'),
            bookmarkBtn: document.getElementById('bookmarkBtn'),
            annotateBtn: document.getElementById('annotateBtn'),
            teaserList: document.getElementById('teaserList'),
            quizQuestion: document.getElementById('quizQuestion'),
            quizSubmitBtn: document.getElementById('quizSubmitBtn'),
            quizResult: document.getElementById('quizResult'),
            factList: document.getElementById('factList'),
            chatBox: document.getElementById('chatBox'),
            chatInput: document.getElementById('chatInput'),
            chatSendBtn: document.getElementById('chatSendBtn'),
            treeCanvas: document.getElementById('treeCanvas'),
            plantTreeBtn: document.getElementById('plantTreeBtn'),
            feedbackInput: document.getElementById('feedbackInput'),
            feedbackSubmitBtn: document.getElementById('feedbackSubmitBtn'),
            planetCanvas: document.getElementById('planetCanvas'),
            welcomeModal: document.getElementById('welcomeModal'),
            startTourBtn: document.getElementById('startTourBtn'),
            closeWelcomeBtn: document.getElementById('closeWelcomeBtn'),
            debugConsole: document.getElementById('debugConsole'),
            contactForm: document.getElementById('contactForm'),
            contactResult: document.getElementById('contactResult'),
        };

        // Utilities
        function sanitizeInput(input) {
            return input.replace(/<[^>]*>/g, '');
        }
        function debounce(func, wait) {
            let timeout;
            return function (...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func(...args), wait);
            };
        }
        function logError(message, details) {
            console.error(message, details);
            if (state.settings.debug) {
                DOM.debugConsole.innerHTML += `<p>[${new Date().toLocaleString()}] ${message}</p>`;
                DOM.debugConsole.scrollTop = DOM.debugConsole.scrollHeight;
            }
        }
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // Mock API
        const api = {
            async fetchBooks() {
                return books;
            },
            async updateState(updates) {
                state = { ...state, ...updates };
                localStorage.setItem('ambururuState', JSON.stringify(state));
                return state;
            },
            async submitFeedback(data) {
                return true;
            },
            async getChatResponse(message) {
                const lowerMessage = message.toLowerCase();
                if (lowerMessage.includes('ombwayo')) return 'Justice Ombwayo is a renowned judge in environmental and land law!';
                if (lowerMessage.includes('luo')) return 'Luo culture is rich in traditions, music, and oral history.';
                return 'Interesting topic! Tell me more!';
            },
        };

        // Initialize App
        async function initializeApp() {
            console.log('Initializing Ambururu Knowledge Hub');
            document.body.appendChild(Object.assign(document.createElement('div'), {
                className: 'loading-spinner',
                textContent: 'Loading...',
            }));
            try {
                await loadState();
                initializeThreeJS();
                initializeTreeCanvas();
                initializeLibrary();
                initializeChatbot();
                initializeContactForm();
                initializeAccordions();
                initializeTour();
                renderTeasers();
                renderFunFacts();
                initializeEventListeners();
                document.querySelector('.loading-spinner').remove();
                document.body.classList.add('loaded');
                showNotification('Welcome to Ambururu Knowledge Hub!', 'success');
            } catch (err) {
                logError('App initialization failed', { error: err.message });
                showNotification('Error loading page', 'error');
                document.querySelector('.loading-spinner').remove();
                document.body.classList.add('loaded');
            }
        }

        async function loadState() {
            const savedState = localStorage.getItem('ambururuState');
            if (savedState) {
                state = { ...state, ...JSON.parse(savedState) };
                applySettings();
                updateProfileDisplay();
            }
        }

        function applySettings() {
            document.body.className = state.settings.theme;
            document.documentElement.style.setProperty('--font-size-base', `${state.settings.fontSize}rem`);
            DOM.readerContainer.className = `reader-container ${state.settings.readerTheme}`;
            document.body.classList.toggle('high-contrast', state.settings.highContrast);
            DOM.debugConsole.style.display = state.settings.debug ? 'block' : 'none';
            DOM.languageSelect.value = state.settings.language;
            DOM.themeSelect.value = state.settings.theme;
            DOM.fontSizeInput.value = state.settings.fontSize;
            DOM.readerThemeSelect.value = state.settings.readerTheme;
            DOM.highContrastToggle.checked = state.settings.highContrast;
            DOM.debugToggle.checked = state.settings.debug;
            translateUI();
        }

        function translateUI() {
            const lang = state.settings.language;
            const translations = CONFIG.TRANSLATIONS[lang] || CONFIG.TRANSLATIONS.en;
            document.querySelector('header h1').textContent = translations.welcome;
            DOM.searchInput.placeholder = translations.searchPlaceholder;
            document.querySelector('#profile h2').textContent = translations.profile;
            document.querySelector('#settings h2').textContent = translations.settings;
            document.querySelector('#ambururuLibrary h2').textContent = translations.elysianLibrary;
            document.querySelector('#globalConclave h2').textContent = translations.globalConclave;
            document.querySelector('#virtualTreePlanting h2').textContent = translations.virtualTree;
            document.querySelector('#guardianFeedback h2').textContent = translations.guardianFeedback;
            document.querySelector('#visualization h2').textContent = translations.visualization;
        }

        function updateProfileDisplay() {
            DOM.nicknameDisplay.textContent = state.user.nickname;
            DOM.shardsDisplay.textContent = state.user.shards;
            DOM.rankLevelDisplay.textContent = state.user.rankLevel;
            DOM.rankXPDisplay.textContent = state.user.rankXP;
            DOM.treesPlantedDisplay.textContent = state.user.treesPlanted;
            DOM.resumeReadingBtn.style.display = state.user.lastBook ? 'block' : 'none';
        }

        // Three.js Visualization
        function initializeThreeJS() {
            if (!window.THREE) {
                logError('Three.js not loaded', {});
                DOM.planetCanvas.style.display = 'none';
                return;
            }
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, DOM.planetCanvas.clientWidth / 250, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: DOM.planetCanvas, alpha: true });
            renderer.setSize(DOM.planetCanvas.clientWidth, 250);
            const geometry = new THREE.SphereGeometry(1, 32, 32);
            const material = new THREE.MeshBasicMaterial({ color: 0xFFD700, wireframe: true });
            const sphere = new THREE.Mesh(geometry, material);
            scene.add(sphere);
            camera.position.z = 3;
            function animate() {
                requestAnimationFrame(animate);
                sphere.rotation.y += 0.005;
                renderer.render(scene, camera);
            }
            animate();
            window.addEventListener('resize', () => {
                renderer.setSize(DOM.planetCanvas.clientWidth, 250);
                camera.aspect = DOM.planetCanvas.clientWidth / 250;
                camera.updateProjectionMatrix();
            });
        }

        // Library
        function initializeLibrary() {
            state.library = books;
            renderLibrary();
            DOM.searchInput.addEventListener('input', debounce(() => {
                renderLibrary();
                showAutocompleteSuggestions();
            }, 300));
            DOM.genreFilter.addEventListener('change', renderLibrary);
            DOM.tagFilterNew.addEventListener('change', renderLibrary);
            DOM.tagFilterPopular.addEventListener('change', renderLibrary);
            DOM.sortFilter.addEventListener('change', renderLibrary);
        }

        function renderLibrary() {
            let filteredBooks = applyFilters(state.library);
            DOM.libraryBooks.innerHTML = filteredBooks.map(book => `
                <div class="book-card" data-book-id="${book.id}" role="listitem" tabindex="0">
                    <img src="${book.cover}" alt="${sanitizeInput(book.title)}" loading="lazy" onerror="this.src='/images/placeholder.jpg'">
                    <div>
                        <h3>${sanitizeInput(book.title)}</h3>
                        <p><strong>Author:</strong> ${sanitizeInput(book.author)}</p>
                        <p><strong>Year:</strong> ${book.year}</p>
                        <p>${sanitizeInput(book.summary)}</p>
                        <button class="ambur-button read-btn" data-book-id="${book.id}" aria-label="Read ${book.title}">Read</button>
                    </div>
                </div>
            `).join('');
            document.querySelectorAll('.read-btn').forEach(btn => btn.addEventListener('click', () => openBook(btn.dataset.bookId)));
            document.querySelectorAll('.book-card').forEach(card => card.addEventListener('keypress', e => e.key === 'Enter' && openBook(card.dataset.bookId)));
        }

        function applyFilters(books) {
            let result = [...books];
            if (DOM.searchInput.value && window.Fuse) {
                const fuse = new Fuse(books, {
                    keys: ['title', 'author', 'keywords'],
                    threshold: 0.3,
                    includeScore: true,
                });
                result = fuse.search(DOM.searchInput.value).map(r => r.item);
            }
            if (DOM.genreFilter.value !== 'all') {
                result = result.filter(book => book.genre === DOM.genreFilter.value);
            }
            if (DOM.tagFilterNew.checked) result = result.filter(book => book.isNew);
            if (DOM.tagFilterPopular.checked) result = result.filter(book => book.isPopular);
            return result.sort((a, b) => {
                if (DOM.sortFilter.value === 'title') return a.title.localeCompare(b.title);
                if (DOM.sortFilter.value === 'author') return a.author.localeCompare(b.author);
                if (DOM.sortFilter.value === 'date') return b.year - a.year;
                return 0;
            });
        }

        function showAutocompleteSuggestions() {
            const query = DOM.searchInput.value.toLowerCase();
            if (query.length < 2) {
                DOM.autocompleteSuggestions.style.display = 'none';
                return;
            }
            const fuse = new Fuse(state.library, {
                keys: ['title', 'author', 'keywords'],
                threshold: 0.3,
            });
            const suggestions = fuse.search(query).slice(0, 5).map(r => r.item);
            DOM.autocompleteSuggestions.innerHTML = suggestions.map(book => `
                <div class="autocomplete-item" data-book-id="${book.id}" role="option">${sanitizeInput(book.title)} by ${sanitizeInput(book.author)}</div>
            `).join('');
            DOM.autocompleteSuggestions.style.display = suggestions.length ? 'block' : 'none';
            document.querySelectorAll('.autocomplete-item').forEach(item => {
                item.addEventListener('click', () => {
                    DOM.searchInput.value = item.textContent.split(' by ')[0];
                    DOM.autocompleteSuggestions.style.display = 'none';
                    openBook(item.dataset.bookId);
                });
                item.addEventListener('keypress', e => e.key === 'Enter' && item.click());
            });
        }

        function openBook(bookId) {
            const book = state.library.find(b => b.id === bookId);
            if (!book) {
                showNotification('Book not found', 'error');
                return;
            }
            state.user.lastBook = bookId;
            state.user.readingProgress[bookId] = state.user.readingProgress[bookId] || 0;
            DOM.readerContent.innerHTML = `
                <h3>${sanitizeInput(book.title)}</h3>
                <p><strong>Author:</strong> ${sanitizeInput(book.author)}</p>
                <p><strong>Year:</strong> ${book.year}</p>
                <p>${sanitizeInput(book.summary)}</p>
                <p><em>Sample content: Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</em></p>
            `;
            DOM.readingProgressBar.style.width = `${state.user.readingProgress[bookId] * 100}%`;
            DOM.resumeReadingBtn.style.display = 'block';
            api.updateState({ user: state.user });
            showNotification(`Now reading: ${book.title}`, 'info');
        }

        // Tree Canvas
        function initializeTreeCanvas() {
            const ctx = DOM.treeCanvas.getContext('2d');
            function drawTree(x, y, height) {
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(x - 10, y - height, 20, height);
                ctx.fillStyle = '#2E8B57';
                ctx.beginPath();
                ctx.arc(x, y - height, 30, 0, Math.PI * 2);
                ctx.fill();
            }
            function redrawTrees() {
                ctx.clearRect(0, 0, DOM.treeCanvas.width, DOM.treeCanvas.height);
                state.trees.forEach(tree => drawTree(tree.x, tree.y, tree.height));
            }
            DOM.plantTreeBtn.addEventListener('click', () => {
                const x = Math.random() * (DOM.treeCanvas.width - 60) + 30;
                const y = DOM.treeCanvas.height - 10;
                let height = 20;
                state.trees.push({ x, y, height });
                state.user.treesPlanted++;
                DOM.treesPlantedDisplay.textContent = state.user.treesPlanted;
                function grow() {
                    if (height < 50) {
                        height += 5;
                        redrawTrees();
                        setTimeout(grow, 200);
                    }
                }
                grow();
                api.updateState({ user: state.user, trees: state.trees });
                showNotification('Tree planted!', 'success');
            });
            redrawTrees();
        }

        // Chatbot
        function initializeChatbot() {
            DOM.chatSendBtn.addEventListener('click', sendChatMessage);
            DOM.chatInput.addEventListener('keypress', e => e.key === 'Enter' && sendChatMessage());
        }

        async function sendChatMessage() {
            const message = DOM.chatInput.value.trim();
            if (!message || message.length > CONFIG.MAX_CHAT_MESSAGE_LENGTH) {
                showNotification('Invalid message', 'error');
                return;
            }
            state.chatbotMessages.push({ user: state.user.nickname, message: sanitizeInput(message) });
            const botResponse = await api.getChatResponse(message);
            state.chatbotMessages.push({ user: 'Ambururu Bot', message: botResponse });
            renderChat();
            DOM.chatInput.value = '';
        }

        function renderChat() {
            DOM.chatBox.innerHTML = state.chatbotMessages
                .slice(-50)
                .map(msg => `<div class="chat-message ${msg.user === state.user.nickname ? 'user' : 'bot'}">${sanitizeInput(msg.user)}: ${sanitizeInput(msg.message)}</div>`)
                .join('');
            DOM.chatBox.scrollTop = DOM.chatBox.scrollHeight;
        }

        // Brain Teasers
        function renderTeasers() {
            DOM.teaserList.innerHTML = teasers.map(teaser => `
                <div class="teaser-card" data-teaser-id="${teaser.id}" role="listitem" tabindex="0">
                    <h3>${sanitizeInput(teaser.question)}</h3>
                    <button class="ambur-button" data-teaser-id="${teaser.id}" aria-label="Play teaser ${teaser.question}">Play</button>
                </div>
            `).join('');
            document.querySelectorAll('.teaser-card button').forEach(btn => btn.addEventListener('click', () => playTeaser(btn.dataset.teaserId)));
            document.querySelectorAll('.teaser-card').forEach(card => card.addEventListener('keypress', e => e.key === 'Enter' && playTeaser(card.dataset.teaserId)));
        }

        function playTeaser(teaserId) {
            const teaser = teasers.find(t => t.id === teaserId);
            DOM.quizQuestion.innerHTML = `
                <h3>${sanitizeInput(teaser.question)}</h3>
                ${teaser.options.map(opt => `<label><input type="radio" name="quiz" value="${opt}" aria-label="${opt}">${sanitizeInput(opt)}</label>`).join('')}
            `;
            DOM.quizSubmitBtn.style.display = 'block';
            DOM.quizSubmitBtn.onclick = () => {
                const selected = document.querySelector('input[name="quiz"]:checked');
                if (!selected) {
                    showNotification('Select an answer', 'warning');
                    return;
                }
                if (selected.value === teaser.answer) {
                    state.user.shards += teaser.reward;
                    state.user.rankXP += teaser.reward;
                    if (state.user.rankXP >= state.user.rankLevel * 100) {
                        state.user.rankLevel++;
                        state.user.rankXP = 0;
                    }
                    DOM.shardsDisplay.textContent = state.user.shards;
                    DOM.rankLevelDisplay.textContent = state.user.rankLevel;
                    DOM.rankXPDisplay.textContent = state.user.rankXP;
                    DOM.quizResult.textContent = `Correct! +${teaser.reward} Shards`;
                    api.updateState({ user: state.user });
                } else {
                    DOM.quizResult.textContent = 'Incorrect. Try again!';
                }
            };
        }

        // Fun Facts
        function renderFunFacts() {
            DOM.factList.innerHTML = funFacts.map(fact => `
                <div class="fact-card" role="listitem">
                    <img src="${fact.image}" alt="${sanitizeInput(fact.title)}" loading="lazy" onerror="this.src='/images/placeholder.jpg'">
                    <div>
                        <h3>${sanitizeInput(fact.title)}</h3>
                        <p>${sanitizeInput(fact.content)}</p>
                    </div>
                </div>
            `).join('');
        }

        // Contact Form
        function initializeContactForm() {
            DOM.contactForm.addEventListener('submit', async e => {
                e.preventDefault();
                const data = {
                    name: sanitizeInput(DOM.contactName.value),
                    email: sanitizeInput(DOM.contactEmail.value),
                    message: sanitizeInput(DOM.contactMessage.value),
                };
                const success = await api.submitFeedback(data);
                DOM.contactResult.textContent = success ? 'Message sent!' : 'Error sending message';
                if (success) DOM.contactForm.reset();
                showNotification(success ? 'Message sent!' : 'Error', success ? 'success' : 'error');
            });
        }

        // Accordions
        function initializeAccordions() {
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    content.classList.toggle('active');
                    header.setAttribute('aria-expanded', content.classList.contains('active'));
                });
                header.addEventListener('keypress', e => e.key === 'Enter' && header.click());
            });
        }

        // Tour
        function initializeTour() {
            if (!localStorage.getItem('tourCompleted')) {
                DOM.welcomeModal.style.display = 'block';
            }
            DOM.startTourBtn.addEventListener('click', () => {
                state.tour.isActive = true;
                state.tour.currentStep = 0;
                DOM.welcomeModal.style.display = 'none';
                showTourStep();
            });
            DOM.closeWelcomeBtn.addEventListener('click', () => {
                DOM.welcomeModal.style.display = 'none';
                localStorage.setItem('tourCompleted', 'true');
            });
        }

        function showTourStep() {
            if (!state.tour.isActive || state.tour.currentStep >= CONFIG.TOUR_STEPS.length) {
                state.tour.isActive = false;
                state.tour.lastCompleted = state.tour.currentStep - 1;
                api.updateState({ tour: state.tour });
                localStorage.setItem('tourCompleted', 'true');
                showNotification('Tour completed!', 'success');
                return;
            }
            const step = CONFIG.TOUR_STEPS[state.tour.currentStep];
            const element = document.querySelector(step.selector);
            if (!element) {
                logError('Tour step element not found', { selector: step.selector });
                state.tour.currentStep++;
                showTourStep();
                return;
            }
            element.scrollIntoView({ behavior: 'smooth' });
            element.classList.add('highlight');
            const tooltip = document.createElement('div');
            tooltip.className = 'notification info';
            tooltip.textContent = step.content;
            tooltip.style.position = 'absolute';
            tooltip.style.zIndex = '2000';
            const rect = element.getBoundingClientRect();
            tooltip.style.top = `${rect.bottom + window.scrollY + 10}px`;
            tooltip.style.left = `${rect.left}px`;
            document.body.appendChild(tooltip);
            setTimeout(() =>            {
                element.classList.remove('highlight');
                tooltip.remove();
                state.tour.currentStep++;
                showTourStep();
            }, 3000);
        }

        // Event Listeners
        function initializeEventListeners() {
            DOM.editNicknameBtn.addEventListener('click', () => {
                const nickname = prompt('Enter new nickname:', state.user.nickname);
                if (nickname && nickname.length <= CONFIG.MAX_NICKNAME_LENGTH) {
                    state.user.nickname = sanitizeInput(nickname);
                    DOM.nicknameDisplay.textContent = state.user.nickname;
                    api.updateState({ user: state.user });
                    showNotification('Nickname updated', 'success');
                } else {
                    showNotification('Invalid nickname', 'error');
                }
            });

            DOM.resetProfileBtn.addEventListener('click', () => {
                if (confirm('Reset profile? This will clear all progress.')) {
                    state.user = {
                        nickname: 'Guardian',
                        shards: 0,
                        rankLevel: 1,
                        rankXP: 0,
                        treesPlanted: 0,
                        lastBook: null,
                        readingProgress: {},
                        bookmarks: [],
                        annotations: [],
                    };
                    state.trees = [];
                    updateProfileDisplay();
                    initializeTreeCanvas();
                    api.updateState({ user: state.user, trees: state.trees });
                    showNotification('Profile reset', 'success');
                }
            });

            DOM.resumeReadingBtn.addEventListener('click', () => openBook(state.user.lastBook));

            DOM.themeSelect.addEventListener('change', () => {
                state.settings.theme = DOM.themeSelect.value;
                applySettings();
                api.updateState({ settings: state.settings });
            });

            DOM.fontSizeInput.addEventListener('input', () => {
                state.settings.fontSize = parseFloat(DOM.fontSizeInput.value);
                applySettings();
                api.updateState({ settings: state.settings });
            });

            DOM.readerThemeSelect.addEventListener('change', () => {
                state.settings.readerTheme = DOM.readerThemeSelect.value;
                applySettings();
                api.updateState({ settings: state.settings });
            });

            DOM.languageSelect.addEventListener('change', () => {
                state.settings.language = DOM.languageSelect.value;
                translateUI();
                api.updateState({ settings: state.settings });
            });

            DOM.highContrastToggle.addEventListener('change', () => {
                state.settings.highContrast = DOM.highContrastToggle.checked;
                applySettings();
                api.updateState({ settings: state.settings });
            });

            DOM.debugToggle.addEventListener('change', () => {
                state.settings.debug = DOM.debugToggle.checked;
                applySettings();
                api.updateState({ settings: state.settings });
            });

            DOM.prevPageBtn.addEventListener('click', () => {
                if (state.user.lastBook) {
                    state.user.readingProgress[state.user.lastBook] = Math.max(0, (state.user.readingProgress[state.user.lastBook] || 0) - 0.1);
                    DOM.readingProgressBar.style.width = `${state.user.readingProgress[state.user.lastBook] * 100}%`;
                    api.updateState({ user: state.user });
                    showNotification('Previous page', 'info');
                }
            });

            DOM.nextPageBtn.addEventListener('click', () => {
                if (state.user.lastBook) {
                    state.user.readingProgress[state.user.lastBook] = Math.min(1, (state.user.readingProgress[state.user.lastBook] || 0) + 0.1);
                    DOM.readingProgressBar.style.width = `${state.user.readingProgress[state.user.lastBook] * 100}%`;
                    api.updateState({ user: state.user });
                    showNotification('Next page', 'info');
                }
            });

            DOM.bookmarkBtn.addEventListener('click', () => {
                if (state.user.lastBook) {
                    const progress = state.user.readingProgress[state.user.lastBook] || 0;
                    state.user.bookmarks.push({
                        bookId: state.user.lastBook,
                        progress: progress,
                        timestamp: new Date().toLocaleString(),
                    });
                    api.updateState({ user: state.user });
                    showNotification(`Bookmark added at ${Math.round(progress * 100)}%`, 'success');
                }
            });

            DOM.annotateBtn.addEventListener('click', () => {
                if (state.user.lastBook) {
                    const note = prompt('Enter your annotation:');
                    if (note) {
                        state.user.annotations.push({
                            bookId: state.user.lastBook,
                            progress: state.user.readingProgress[state.user.lastBook] || 0,
                            note: sanitizeInput(note),
                            timestamp: new Date().toLocaleString(),
                        });
                        api.updateState({ user: state.user });
                        showNotification('Annotation added', 'success');
                    }
                }
            });

            DOM.feedbackSubmitBtn.addEventListener('click', async () => {
                const feedback = DOM.feedbackInput.value.trim();
                if (feedback && feedback.length <= CONFIG.MAX_FEEDBACK_LENGTH) {
                    await api.submitFeedback({ user: state.user.nickname, feedback });
                    DOM.feedbackInput.value = '';
                    showNotification('Feedback sent', 'success');
                } else {
                    showNotification('Invalid feedback', 'error');
                }
            });

            // Keyboard Accessibility
            document.addEventListener('keydown', e => {
                if (e.key === 'Escape') {
                    DOM.welcomeModal.style.display = 'none';
                    DOM.autocompleteSuggestions.style.display = 'none';
                }
            });

            // Lazy Load Images
            const images = document.querySelectorAll('img[loading="lazy"]');
            if ('IntersectionObserver' in window) {
                const observer = new IntersectionObserver((entries, obs) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.src;
                            obs.unobserve(img);
                        }
                    });
                });
                images.forEach(img => observer.observe(img));
            }
        }

        // Initialize App
        initializeApp();
    </script>
</body>
</html>